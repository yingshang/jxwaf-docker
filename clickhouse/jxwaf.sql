use siem;
create table jxwaf( timestamp DateTime, bytes_received String NULL, server_uuid String NULL, protection_info String NULL, method String NULL, host String NULL, client_ip String NULL, user_agent String NULL, query_string String NULL, uri String NULL, connections_active String NULL, upstream_bytes_sent String NULL, port Int8 NULL, log_type String NULL, scheme String NULL, request_process_time String NULL, body String NULL, upstream_addr String NULL, status String NULL, upstream_bytes_received String NULL, bytes_sent String NULL, uuid String NULL, connections_waiting String NULL, version String NULL, upstream_status String NULL, upstream_response_time String NULL, protection_type String NULL, raw_header String NULL )ENGINE MergeTree() PARTITION BY toYYYYMMDD(timestamp) ORDER BY (timestamp) SETTINGS index_granularity=8192;
create table jxwaf_kafka( timestamp DateTime, bytes_received String NULL, server_uuid String NULL, protection_info String NULL, method String NULL, host String NULL, client_ip String NULL, user_agent String NULL, query_string String NULL, uri String NULL, connections_active String NULL, upstream_bytes_sent String NULL, port Int8 NULL, log_type String NULL, scheme String NULL, request_process_time String NULL, body String NULL, upstream_addr String NULL, status String NULL, upstream_bytes_received String NULL, bytes_sent String NULL, uuid String NULL, connections_waiting String NULL, version String NULL, upstream_status String NULL, upstream_response_time String NULL, protection_type String NULL, raw_header String NULL )ENGINE = Kafka('kafka:9092','jxwaf','jxwaf_group') SETTINGS kafka_format = 'JSONEachRow',kafka_skip_broken_messages=4;
CREATE MATERIALIZED VIEW jxwaf_queue_view TO jxwaf AS SELECT * FROM jxwaf_kafka;